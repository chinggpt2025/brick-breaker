---
description: 使用喬哈裡視窗框架進行完整程式碼審計，找出所有盲區並修復
---

# `/audit`｜自動化審計與自我校正工作流程

**目標定義**
透過一次指令，自動完成結構、語義、安全、行為與異常處理的系統性審計；
不僅發現問題，還判斷嚴重度、是否合理存在，並給出可執行的處理路徑，避免重複犯錯。

---

## 一｜審計前置：意圖與情境聲明（強制）

在執行審計前，系統必須先識別或要求以下上下文，用於校正判斷標準：

* 當前階段：
  * demo / 原型
  * MVP
  * production

* 允許例外項：
  * 是否允許硬編碼文案
  * 是否允許未綁定事件的 UI
  * 是否允許簡化錯誤處理

> 若未聲明，默認按 **MVP + 中等嚴格度** 處理。

---

## 二｜核心審計模組（五大類）

### 1｜HTML ↔ JS 結構綁定驗證

**檢查內容**
* HTML 中所有使用的 id，是否都有對應 JS 引用或事件綁定
* JS 中所有引用的 DOM id，是否真實存在於 HTML
* 動態生成元素是否存在安全的掛載與解綁機制

**風險判斷**
* 致命：JS 依賴不存在的 DOM，導致功能中斷
* 重要：HTML 存在無用途 id，增加維護成本
* 可接受：為未來功能預留的佔位元素（需標註）

---

### 2｜i18n 與文案一致性檢查

**檢查內容**
* 是否存在不必要的硬編碼中文字串
* 所有 `data-i18n` key 是否有對應翻譯
* 翻譯 key 是否存在未被使用的冗餘項

**風險判斷**
* 致命：生產環境缺失關鍵文案導致功能不可理解
* 重要：部分文案未國際化，影響擴展性
* 可接受：demo / MVP 階段的臨時硬編碼（需聲明）

---

### 3｜安全性掃描

**檢查內容**
* 是否存在 `innerHTML` 直接渲染未過濾輸入
* 是否存在潛在 XSS / 注入風險
* 是否暴露 API key、token、內部路徑等敏感資訊

**風險判斷**
* 致命：可被直接利用的安全漏洞
* 重要：潛在風險但未形成直接攻擊路徑
* 可接受：本地 demo 中的臨時測試程式碼（禁止進入 production）

---

### 4｜事件與行為完整性檢查

**檢查內容**
* 所有可交互 UI（按鈕、表單、控件）是否有對應處理邏輯
* Modal / Drawer 是否同時具備開啟與關閉邏輯
* 是否存在「看似可點但無反應」的介面陷阱

**風險判斷**
* 致命：關鍵操作無處理邏輯，用戶流程中斷
* 重要：非關鍵 UI 行為缺失，體驗下降
* 可接受：佔位 UI 或未來功能入口（需明確標註）

---

### 5｜錯誤與異常處理檢查

**檢查內容**
* async / await 是否有 try-catch 或等效處理
* 是否存在直接使用 `alert()` 而非統一通知機制
* 是否有吞掉錯誤、不記錄、不反饋的情況

**風險判斷**
* 致命：異常導致系統崩潰或無反饋
* 重要：錯誤可恢復但用戶無感知
* 可接受：內部工具或快速原型的簡化處理

---

## 三｜嚴重度分級與處理策略（強制）

每一條審計結果，必須歸類為以下之一：

| 等級 | 默認動作 |
|------|----------|
| **致命** | 阻斷合併 / 強制修復 |
| **重要** | 生成修復建議，不阻斷 |
| **可接受** | 記錄為技術債或已知限制 |

---

## 四｜審計結果輸出格式（統一）

審計輸出必須包含：

* 問題描述
* 所屬模組
* 嚴重度等級
* 是否與當前階段意圖衝突
* 建議動作（修復 / 延後 / 忽略）

---

## 五｜自我校正與重複問題檢測（關鍵）

系統必須額外執行以下判斷：

* 是否與過往審計中已出現的問題模式相同
* 若同類問題重複出現：
  * 標記為「生成規則缺陷」
  * 提示應修正上游生成邏輯，而非僅修程式碼

> 目標不是「修得更勤勞」，而是「少犯同樣的錯」。

---

## 六｜終止條件與收斂規則

* 所有 **致命問題** 為 0 → 審計通過
* 若致命問題 > 0 → 阻斷並輸出修復優先級
* 若僅剩重要 / 可接受問題 → 審計完成並記錄

---

## 設計原則聲明（不可省略）

* 審計不是為了找錯，而是為了減少未來的錯誤密度
* 審計不是靜態檢查，而是可學習、可修正的系統
* 「不行動」與「接受技術債」是合法輸出之一
